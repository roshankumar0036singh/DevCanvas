flowchart TD
%% --- Core Components ---
    subgraph User_Interface["User Interface"]
        A1["Popup\n(App.tsx)"]
        A2["Diagram Editor\n(DiagramEditor.tsx)"]
        A3["Diagram Renderer\n(DiagramRenderer.tsx)"]
        A4["Node Templates\n(flowNodes/)"]
        A5["Overlay\n(Overlay.tsx)"]
    end

    subgraph Core_Services["Core Services"]
        B1["AI Processing\n(aiService.ts)"]
        B2["File System\n(fileSystem.ts)"]
        B3["Messaging\n(messaging.ts)"]
        B4["Storage\n(storage.ts)"]
        B5["RAG Engine\n(rag/)"]
    end

    subgraph Utility_Components["Utility Components"]
        C1["Exporters\n(exporters.ts)"]
        C2["Layout Algorithms\n(layout.ts)"]
        C3["Structure Parser\n(structureParser.ts)"]
        C4["Mermaid Converter\n(MermaidConverter.ts)"]
    end

    %% --- External Interactions ---
    D1[("User")]
    D2[("Browser Context")]
    D3[("Local Storage")]
    D4[("GitHub API\n(githubService.ts)")]

    %% --- Logical Flow ---
    D1 -->|Triggers Action| A1
    A1 -->|Renders| A2
    A1 -->|Displays| A5
    A2 -->|Uses| A3
    A2 -->|Loads| A4
    A2 -->|Saves/Loads| B4
    A2 -->|Exports| C1
    A2 -->|Converts| C4
    A2 -->|Processes| B1
    A2 -->|Lays Out| C2
    A2 -->|Parses| C3
    B1 -->|Uses| B5
    B2 -->|Reads/Writes| D3
    B3 -->|Communicates| D2
    B4 -->|Persists| D3
    B5 -->|Ingests| D4
    C1 -->|Generates| D2
    C3 -->|Validates| A2
    D2 -->|Hosts| A5